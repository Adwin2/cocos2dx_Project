# 快速修改参考手册

## 🚀 一分钟快速定位

### 我想修改...

| 修改内容 | 文件位置 | 大概行数 | 需要重新编译 |
|---------|---------|---------|-------------|
| 窗口大小 | `AppDelegate.cpp` | 80-120 | ✅ |
| 卡牌间距 | `GameConfig.cpp` | 15-20 | ✅ |
| 背景颜色 | `GameConfig.cpp` | 25-30 | ✅ |
| 匹配规则 | `GameLogicService.cpp` | 15-25 | ✅ |
| 得分数值 | `GameConfig.cpp` | 5-10 | ✅ |
| 卡牌图片 | `ResourceService.cpp` + `Resources/` | 10-15 | ✅ |
| 字体文件 | `GameConfig.cpp` | 35-40 | ✅ |
| 动画速度 | `GameConfig.cpp` | 8-12 | ✅ |

## 📝 常用代码片段

### 1. 修改窗口大小
```cpp
// 文件: AppDelegate.cpp (约第90行)
glview->setFrameSize(1920, 1080);  // 改为1920x1080
director->getOpenGLView()->setDesignResolutionSize(1920, 1080, ResolutionPolicy::SHOW_ALL);
```

### 2. 修改卡牌布局
```cpp
// 文件: GameConfig.cpp
const float GameConfig::CardSettings::CARD_SPACING = 150.0f;  // 卡牌间距
const Vec2 GameConfig::PositionSettings::BOTTOM_CARD_OFFSET = Vec2(200, 0);  // 底牌位置
```

### 3. 修改颜色主题
```cpp
// 文件: GameConfig.cpp
const Color3B GameConfig::ColorSettings::BACKGROUND_COLOR = Color3B(30, 30, 60);  // 深蓝背景
const Color3B GameConfig::ColorSettings::WIN_TEXT_COLOR = Color3B::YELLOW;  // 黄色胜利文字
```

### 4. 修改游戏规则
```cpp
// 文件: GameLogicService.cpp (约第18行)
bool GameLogicService::canMatch(const CardModel& card1, const CardModel& card2)
{
    // 原规则: 相同数值或花色
    // return (card1.getValue() == card2.getValue()) || (card1.getSuit() == card2.getSuit());
    
    // 新规则: 只有相同数值
    return (card1.getValue() == card2.getValue());
    
    // 新规则: 只有相同花色
    // return (card1.getSuit() == card2.getSuit());
    
    // 新规则: 相邻数值也可匹配
    // int diff = abs(card1.getValue() - card2.getValue());
    // return (diff == 0 || diff == 1);
}
```

### 5. 修改得分系统
```cpp
// 文件: GameConfig.cpp
const int GameConfig::GameSettings::MATCH_SCORE = 20;  // 基础得分改为20

// 文件: GameLogicService.cpp (约第55行)
int GameLogicService::calculateMatchScore(const CardModel& card1, const CardModel& card2, int level)
{
    int baseScore = GameConfig::GameSettings::MATCH_SCORE;
    
    // 相同数值双倍得分
    if (card1.getValue() == card2.getValue()) {
        baseScore *= 2;
    }
    
    // 关卡倍数
    baseScore *= level;
    
    return baseScore;
}
```

### 6. 添加新的卡牌动画
```cpp
// 文件: CardView.cpp (约第150行)
void CardView::playCustomAnimation()
{
    // 旋转动画
    auto rotate = RotateBy::create(0.5f, 360);
    
    // 缩放动画
    auto scaleUp = ScaleTo::create(0.2f, 1.2f);
    auto scaleDown = ScaleTo::create(0.2f, 1.0f);
    auto scaleSeq = Sequence::create(scaleUp, scaleDown, nullptr);
    
    // 组合动画
    auto spawn = Spawn::create(rotate, scaleSeq, nullptr);
    this->runAction(spawn);
}
```

## 🔧 添加新功能模板

### 添加新的服务类
```cpp
// 1. 创建头文件: Classes/services/NewService.h
#ifndef __NEW_SERVICE_H__
#define __NEW_SERVICE_H__

class NewService
{
public:
    static void doSomething();
private:
    NewService() = delete;
};

#endif

// 2. 创建实现文件: Classes/services/NewService.cpp
#include "NewService.h"

void NewService::doSomething()
{
    // 实现功能
}

// 3. 修改 CMakeLists.txt，添加：
// Classes/services/NewService.cpp (在GAME_SOURCE中)
// Classes/services/NewService.h (在GAME_HEADER中)
```

### 添加新的配置项
```cpp
// 文件: GameConfig.h
struct NewSettings
{
    static const int NEW_VALUE;
    static const float NEW_SPEED;
};

// 文件: GameConfig.cpp
const int GameConfig::NewSettings::NEW_VALUE = 100;
const float GameConfig::NewSettings::NEW_SPEED = 2.0f;
```

## 🎨 资源文件管理

### 添加新图片资源
1. 将图片放入 `Resources/res/` 目录
2. 在 `ResourceService.cpp` 中添加路径常量
3. 在 `preloadCardResources()` 中添加预加载

```cpp
// ResourceService.h
static const std::string NEW_IMAGE;

// ResourceService.cpp
const std::string ResourceService::Paths::NEW_IMAGE = "res/new_image.png";

// 在 preloadCardResources() 中添加
textureCache->addImage(Paths::NEW_IMAGE);
```

### 更换字体
1. 将字体文件放入 `Resources/fonts/`
2. 修改 `GameConfig.cpp` 中的字体路径
3. 重新编译运行

```cpp
// GameConfig.cpp
const std::string GameConfig::ResourcePaths::FONT_PATH = "fonts/new_font.ttf";
```

## ⚡ 性能优化技巧

### 1. 减少内存使用
```cpp
// 及时清理不用的纹理
Director::getInstance()->getTextureCache()->removeUnusedTextures();

// 使用对象池避免频繁创建销毁
static std::vector<CardView*> cardPool;
```

### 2. 优化动画性能
```cpp
// 使用硬件加速的动画
auto action = MoveTo::create(0.5f, targetPos);  // 比 MoveBy 更高效

// 避免在动画中频繁计算
auto preCalculatedAction = Sequence::create(action1, action2, nullptr);
```

### 3. 资源预加载策略
```cpp
// 分批预加载，避免启动卡顿
void ResourceService::preloadEssentialResources()
{
    // 只加载必需的资源
}

void ResourceService::preloadOptionalResources()
{
    // 后台加载可选资源
}
```

## 🐛 常见错误解决

### 编译错误
```bash
# 错误: undefined reference to 'xxx'
# 解决: 检查 CMakeLists.txt 是否包含对应的 .cpp 文件

# 错误: No such file or directory
# 解决: 检查 #include 路径是否正确

# 错误: 'xxx' was not declared in this scope
# 解决: 检查是否包含对应的头文件
```

### 运行时错误
```cpp
// 资源加载失败
if (!ResourceService::isResourceExists("path/to/resource")) {
    CCLOG("Resource not found: %s", "path/to/resource");
}

// 空指针检查
if (cardView != nullptr) {
    cardView->doSomething();
}
```

## 📊 调试技巧

### 添加调试日志
```cpp
// 使用 CCLOG 输出调试信息
CCLOG("Card matched: %s %d", cardModel.getSuitString().c_str(), cardModel.getValue());

// 条件调试
#ifdef DEBUG
    CCLOG("Debug info: %d", someValue);
#endif
```

### 性能监控
```cpp
// 监控帧率
Director::getInstance()->setDisplayStats(true);

// 监控内存使用
auto textureCache = Director::getInstance()->getTextureCache();
CCLOG("Texture count: %d", textureCache->getCachedTextureInfo().size());
```

---

💡 **提示**: 修改任何 .cpp 或 .h 文件后都需要重新编译  
🔄 **编译命令**: `cd linux-build && make`  
🧹 **清理重建**: `cd linux-build && make clean && make`
